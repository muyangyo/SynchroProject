import{_ as x,r as g,l as I,G as b,h as d,o as O,c as K,b as v,a,w as r,e as w,f as N,U,R as k,H as C,i as m}from"./index-BxUFngmD.js";import{e as _,R as y}from"./RequestTool-Q-bCDsU7.js";import{i as D}from"./IsLocalHost-D6T0nX5p.js";import{r as p}from"./RSAEncryptUtils-Ybv_6rCu.js";const M={class:"login-container"},P={class:"login-box"},T={__name:"Login",setup(q){const V=N(),c=g(null),s=g({username:"",password:"",secretKey:""}),E={username:[{required:!0,type:"string",message:"请输入账号",trigger:"blur"}],password:[{required:!0,type:"string",message:"请输入密码",trigger:"blur"}],secretKey:[{required:!1,type:"string"}]},R=()=>{c.value.validate(async u=>{var e,o;if(u){let l=await _(y.GET,"/admin/getPublicKey","");p.setPublicKey(l.data);const i={username:p.encryptData(s.value.username),password:p.encryptData(s.value.password),key:s.value.secretKey?p.encryptData(s.value.secretKey):""};try{const t=await _(y.POST,"/admin/login",i);t.data===!0&&t.statusCode==="SUCCESS"?(U.login(k.admin,s.value.username,""),d({message:`欢迎回来, ${s.value.username}`,type:"success"}),await V.push(C.managerRouterBaseUrl)):d.error(t.errMsg||"账号或密码错误")}catch(t){d.error(((o=(e=t.response)==null?void 0:e.data)==null?void 0:o.message)||"登录失败")}}})},S=()=>{c.value.resetFields()},f=g(!1);return I(()=>{_(y.GET,"/admin/remoteOperationIsOpen","").then(u=>{u.data===!1?(localStorage.setItem(b.ADMIN_OPERATION_IS_OPEN,"false"),D()||(f.value=!0,d.error({message:"管理操作只能在 <b>127.0.0.1</b> 访问!<br>如果需要远程操作,请设置允许远程访问!",dangerouslyUseHTMLString:!0,duration:5e3,center:!0}))):localStorage.setItem(b.ADMIN_OPERATION_IS_OPEN,"true")})}),(u,e)=>{const o=m("el-input"),l=m("el-form-item"),i=m("el-button"),t=m("el-form");return O(),K("div",M,[v("div",P,[e[5]||(e[5]=v("div",{style:{"text-align":"center","margin-bottom":"20px","font-size":"36px","font-weight":"bold"}}," Login ",-1)),a(t,{model:s.value,rules:E,ref_key:"loginForm",ref:c,"label-width":"80px"},{default:r(()=>[a(l,{label:"账号",prop:"username"},{default:r(()=>[a(o,{modelValue:s.value.username,"onUpdate:modelValue":e[0]||(e[0]=n=>s.value.username=n),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),a(l,{label:"密码",prop:"password"},{default:r(()=>[a(o,{type:"password",modelValue:s.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>s.value.password=n),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),a(l,{label:"密钥",prop:"secretKey"},{default:r(()=>[a(o,{modelValue:s.value.secretKey,"onUpdate:modelValue":e[2]||(e[2]=n=>s.value.secretKey=n),placeholder:"请输入密钥（可选）"},null,8,["modelValue"])]),_:1}),a(l,null,{default:r(()=>[a(i,{type:"primary",onClick:R,disabled:f.value},{default:r(()=>e[3]||(e[3]=[w("登录")])),_:1},8,["disabled"]),a(i,{onClick:S,disabled:f.value},{default:r(()=>e[4]||(e[4]=[w("重置")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])])])}}},h=x(T,[["__scopeId","data-v-466b70f9"]]);export{h as default};
