import{_ as L,r as O,l as S,h as y,q as v,o as w,d as P,w as c,a as s,b as d,I as k,t as D,e as M,u as b,J as U,f as q,E,K as $,i as u,L as X}from"./index-B2LDBmsh.js";import{I as z,s as A}from"./FileSizeConverter-BNP7e8M7.js";import{e as B,R as T,o as V}from"./RequestTool-BpnBfQ7F.js";const j={class:"cloud-index-wrapper"},G={class:"cloud-index-content"},K=["onClick"],W={class:"file-name"},Y={__name:"OutsideshareIndex",setup(J){const r=U(),N=q(),p=r.query.shareCode,t=Object.freeze({IMAGE:"IMAGE",VIDEO:"VIDEO",AUDIO:"AUDIO",TEXT:"TEXT",PDF:"PDF",DOCX:"DOCX",FOLDER:"FOLDER",UNKNOWN:"UNKNOWN",COMPRESSED:"COMPRESSED",EXCEL:"EXCEL",PPT:"PPT",CODE:"CODE"}),m=O([]);O({fileName:"",fileSize:"",modifiedTime:"",filePath:"",mountRootPath:"",fileType:{category:t.UNKNOWN,typeName:"",mimeType:""}});const x=o=>{o.data.forEach(e=>{e.fileType.category===t.FOLDER&&(e.fileSize="")}),m.value=o.data};S(()=>{if(!p){y.error("分享链接无效");return}C(r.query.parentPath)});const C=o=>{B(T.GET,`/file/getShareFile?shareCode=${p}&parentPath=${o||""}`,"",!1,!0).then(e=>{e.statusCode==="SUCCESS"&&e.data?(x(e),m.value=e.data):y.error(e.errMsg)})},g=o=>({[t.VIDEO]:"#icon-shipin",[t.IMAGE]:"#icon-tupian",[t.AUDIO]:"#icon-yinpin",[t.TEXT]:"#icon-TXT",[t.PDF]:"#icon-PDF",[t.DOCX]:"#icon-word",[t.FOLDER]:"#icon-wenjianjia",[t.COMPRESSED]:"#icon-yasuobao",[t.EXCEL]:"#icon-excel",[t.PPT]:"#icon-PPT",[t.CODE]:"#icon-jiaoben",[t.UNKNOWN]:"#icon-weizhi"})[o]||"#icon-weizhi",R=(o,e)=>{if(e.fileType.category===t.FOLDER){const a=r.query.parentPath||"";let n=a?`${a}/${e.fileName}`:e.fileName;N.push({query:{shareCode:p,parentPath:n}})}};v(()=>r.query.parentPath,()=>{const o=r.query.parentPath||"";C(o)});const I=(o,e)=>{let a=null,n=null;e.fileType.category===t.FOLDER&&(a=E.alert("正在生成压缩包，请耐心等待!","提示",{confirmButtonText:"确定",type:"warning",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1,showCancelButton:!1,showConfirmButton:!1}));const _=r.query.parentPath||"";V({method:T.GET,url:`/file/OutsideFileDownload?shareCode=${p}&fileName=${e.fileName}&parentPath=${_}`,responseType:"blob",dataTypes:"blob",timeout:6e4}).then(f=>{a&&E.close(),n=$.service({lock:!0,text:"文件下载中，请稍候...",background:"rgba(32,31,31,0.7)"});const h=window.URL.createObjectURL(f),i=document.createElement("a");i.href=h,i.setAttribute("download",e.fileName),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(h),n.close()}).catch(f=>{a&&E.close(),n&&n.close(),console.error("文件下载失败",f)})};return(o,e)=>{const a=u("el-col"),n=u("el-table-column"),_=u("el-button"),f=u("el-tooltip"),h=u("el-table"),i=u("el-row");return w(),P(i,{gutter:20,class:"cloud-index-container"},{default:c(()=>[s(a,{span:3}),s(a,{span:18},{default:c(()=>[d("div",j,[e[0]||(e[0]=d("div",{class:"cloud-index-header"},[d("h2",{class:"cloud-index-title"},"分享文件")],-1)),d("div",G,[s(h,{data:m.value,"default-sort":{prop:"fileName",order:"descending"},class:"full-width-table custom-table",height:"600px"},{default:c(()=>[s(n,{prop:"fileName",label:"文件名",sortable:"","min-width":"100px","show-overflow-tooltip":!0},{default:c(l=>[d("div",{class:"cell-content",onClick:F=>R(l.$index,l.row)},[l.row.fileType.category?(w(),P(z,{key:0,name:g(l.row.fileType.category)},null,8,["name"])):k("",!0),d("span",W,D(l.row.fileName),1)],8,K)]),_:1}),s(n,{prop:"fileSize",label:"大小",sortable:""},{default:c(l=>[M(D(b(A)(l.row.fileSize)),1)]),_:1}),s(n,{prop:"operation",label:"操作","min-width":"100px"},{default:c(l=>[s(f,{content:"下载",placement:"top","show-arrow":!1},{default:c(()=>[s(_,{type:"success",size:"small",icon:b(X),onClick:F=>I(l.$index,l.row)},null,8,["icon","onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])])])]),_:1}),s(a,{span:3})]),_:1})}}},ee=L(Y,[["__scopeId","data-v-1d86c93a"]]);export{ee as default};
