import{_ as K,r as v,l as R,G as b,h as d,o as x,c as O,b as _,a as t,w as o,e as w,H as C,f as N,i as m,U,R as M,I as D}from"./index-RdXn_IqF.js";import{e as c,R as y}from"./RequestTool-CLoRfp_J.js";import{i as P}from"./IsLocalHost-D6T0nX5p.js";import{r as p}from"./RSAEncryptUtils-Ybv_6rCu.js";const T={class:"login-container"},k={class:"login-box"},q={__name:"Login",setup(L){const V=N(),f=v(null),s=v({username:"",password:"",secretKey:""}),S={username:[{required:!0,type:"string",message:"请输入账号",trigger:"blur"}],password:[{required:!0,type:"string",message:"请输入密码",trigger:"blur"}],secretKey:[{required:!1,type:"string"}]},E=()=>{f.value.validate(async u=>{var e,l;if(u){let n=await c(y.GET,"/admin/getPublicKey","");p.setPublicKey(n.data);const i={username:p.encryptData(s.value.username),password:p.encryptData(s.value.password),key:s.value.secretKey?p.encryptData(s.value.secretKey):""};try{const r=await c(y.POST,"/admin/login",i);r.data===!0&&r.statusCode==="SUCCESS"?(U.login(M.admin,s.value.username,""),d({message:`欢迎回来, ${s.value.username}`,type:"success"}),await V.push(D.managerRouterBaseUrl)):d.error(r.errMsg||"账号或密码错误")}catch(r){d.error(((l=(e=r.response)==null?void 0:e.data)==null?void 0:l.message)||"登录失败")}}})},I=()=>{f.value.resetFields()},g=v(!1);return R(()=>{c(y.GET,"/admin/remoteOperationIsOpen","").then(u=>{u.data===!1?(localStorage.setItem(b.ADMIN_OPERATION_IS_OPEN,"false"),P()||(g.value=!0,d.error({message:"管理操作只能在 <b>127.0.0.1</b> 访问!<br>如果需要远程操作,请设置允许远程访问!",dangerouslyUseHTMLString:!0,duration:5e3,center:!0}))):localStorage.setItem(b.ADMIN_OPERATION_IS_OPEN,"true")})}),(u,e)=>{const l=m("el-input"),n=m("el-form-item"),i=m("el-button"),r=m("el-form");return x(),O("div",T,[_("div",k,[e[8]||(e[8]=_("div",{style:{"text-align":"center","margin-bottom":"20px","font-size":"36px","font-weight":"bold"}}," Login ",-1)),t(r,{model:s.value,rules:S,ref_key:"loginForm",ref:f,"label-width":"80px",onSubmit:C(E,["prevent"])},{default:o(()=>[t(n,{label:"账号",prop:"username"},{default:o(()=>[t(l,{modelValue:s.value.username,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.username=a),onChange:e[1]||(e[1]=a=>s.value.username=s.value.username.trim()),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),t(n,{label:"密码",prop:"password"},{default:o(()=>[t(l,{type:"password",modelValue:s.value.password,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.password=a),onChange:e[3]||(e[3]=a=>s.value.password=s.value.password.trim()),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),t(n,{label:"密钥",prop:"secretKey"},{default:o(()=>[t(l,{modelValue:s.value.secretKey,"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.secretKey=a),onChange:e[5]||(e[5]=a=>s.value.secretKey=s.value.secretKey.trim()),placeholder:"请输入密钥（可选）"},null,8,["modelValue"])]),_:1}),t(n,null,{default:o(()=>[t(i,{type:"primary","native-type":"submit",disabled:g.value},{default:o(()=>e[6]||(e[6]=[w("登录")])),_:1},8,["disabled"]),t(i,{onClick:I,disabled:g.value},{default:o(()=>e[7]||(e[7]=[w("重置")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])])])}}},G=K(q,[["__scopeId","data-v-fd08f517"]]);export{G as default};
