import{_ as I,r as i,l as z,h as p,v as B,o as O,c as R,a as o,w as u,b as f,t as T,e as S,E as D,m as P,i as c,x as k}from"./index-BGzrD_kU.js";import{e as h,R as b}from"./RequestTool-CrgFqHun.js";const A={class:"operation-log-manager"},F={class:"pagination-container"},G={class:"button-group"},U={__name:"OperationLog",setup(V){const C=i(""),n=i([]),v=i(0),_=i(8),r=i(1),m=e=>{h(b.GET,`/syncLog/getLogList?page=${e}&pageSize=${_.value}`,"",!1,!1).then(a=>{a.data&&a.statusCode==="SUCCESS"?(n.value=a.data.list,v.value=a.data.total):p.error(a.errMsg?a.errMsg:"获取操作日志失败!")})};z(()=>{r.value=1,w(),m(r.value)});const w=()=>{h(b.GET,"/syncManager/getStatus",null,!1).then(e=>{e.statusCode==="SUCCESS"?C.value=e.data:p.error("获取用户模式失败")})};B(()=>{n.value=[]});const L=e=>{_.value=e,r.value=1,m(r.value)},M=e=>{r.value=e,m(e)},E=({prop:e,order:a})=>{if(e==="operationTime")n.value.sort((t,s)=>{const l=new Date(t.operationTime).getTime(),d=new Date(s.operationTime).getTime();return a==="descending"?d-l:l-d});else if(e==="operationLevel"){const t={IMPORTANT:3,WARNING:2,INFO:1};n.value.sort((s,l)=>a==="ascending"?t[s.operationLevel]-t[l.operationLevel]:t[l.operationLevel]-t[s.operationLevel])}},y=()=>{D.confirm("确定要删除所有操作日志吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error",icon:P(k)}).then(()=>{h(b.DELETE,"/syncLog/deleteLog","",!1,!1).then(e=>{e.data===!0&&e.statusCode==="SUCCESS"?(p.success("操作日志删除成功!"),n.value=[],v.value=0):p.error(e.errMsg?e.errMsg:"删除操作日志失败!")})})},N=e=>{switch(e){case"INFO":return"info";case"WARNING":return"warning";case"IMPORTANT":return"danger";default:return""}};return(e,a)=>{const t=c("el-table-column"),s=c("el-tag"),l=c("el-table"),d=c("el-pagination"),x=c("el-button");return O(),R("div",A,[o(l,{data:n.value,stripe:"","default-sort":{prop:"operationTime",order:"descending"},onSortChange:E},{default:u(()=>[o(t,{prop:"operationTime",label:"操作时间",sortable:"custom",width:"180"}),o(t,{prop:"operation",label:"操作","show-overflow-tooltip":!0,"min-width":"150"}),o(t,{prop:"targetFile",label:"操作文件","show-overflow-tooltip":!0,"min-width":"200"},{default:u(({row:g})=>[f("span",null,T(g.targetFile),1)]),_:1}),o(t,{prop:"operator",label:"同步名",sortable:"",width:"120"}),o(t,{prop:"ip",label:C.value==="server"?"客户端 IP":"服务器 IP",sortable:"",width:"150"},null,8,["label"]),o(t,{prop:"level",label:"操作级别",sortable:"custom",width:"120"},{default:u(({row:g})=>[o(s,{type:N(g.level)},{default:u(()=>[S(T(g.level),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"]),f("div",F,[o(d,{background:"",layout:"total, prev, pager, next, sizes","page-sizes":[8,12,15],"page-size":_.value,total:v.value,"current-page":r.value,onSizeChange:L,onCurrentChange:M},null,8,["page-size","total","current-page"]),f("div",G,[o(x,{type:"danger",onClick:y,disabled:n.value.length===0},{default:u(()=>a[0]||(a[0]=[S(" 删除全部 ")])),_:1},8,["disabled"])])])])}}},$=I(U,[["__scopeId","data-v-5bffa148"]]);export{$ as default};
